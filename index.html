<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Expense Tracker Pro</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        :root {
            --primary: #5a67d8;
            --secondary: #4c51bf;
            --accent: #7f9cf5;
            --danger: #e53e3e;
            --success: #38a169;
            --light: #f7fafc;
            --dark: #2d3748;
            --gray: #718096;
            --white: #ffffff;
            --border: #e2e8f0;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        body {
            background-color: #edf2f7;
            color: var(--dark);
            line-height: 1.5;
        }

        .container {
            max-width: 1280px;
            margin: 0 auto;
            padding: 24px;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 24px;
            background: var(--white);
            border-radius: 8px;
            box-shadow: var(--shadow);
            margin-bottom: 24px;
        }

        .logo {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary);
            display: flex;
            align-items: center;
        }

        .logo i {
            margin-right: 8px;
            color: var(--accent);
        }

        .header-actions {
            display: flex;
            gap: 12px;
        }

        .total-balance {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 24px;
            margin-bottom: 24px;
        }

        .balance-card {
            background: linear-gradient(145deg, var(--white), #f1f5f9);
            padding: 20px;
            border-radius: 8px;
            box-shadow: var(--shadow);
            transition: transform 0.2s ease;
        }

        .balance-card:hover {
            transform: translateY(-4px);
        }

        .balance-card h3 {
            font-size: 14px;
            color: var(--gray);
            margin-bottom: 8px;
            text-transform: uppercase;
        }

        .balance-amount {
            font-size: 24px;
            font-weight: 600;
        }

        .income-amount { color: var(--success); }
        .expense-amount { color: var(--danger); }

        .btn {
            padding: 10px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            font-size: 14px;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--primary);
            color: var(--white);
        }

        .btn-primary:hover {
            background: var(--secondary);
            transform: translateY(-2px);
        }

        .btn-success {
            background: var(--success);
            color: var(--white);
        }

        .btn-success:hover {
            background: #2f855a;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: var(--danger);
            color: var(--white);
        }

        .btn-danger:hover {
            background: #c53030;
            transform: translateY(-2px);
        }

        .main-content {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 24px;
        }

        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            .total-balance {
                grid-template-columns: 1fr;
                gap: 16px;
            }
        }

        .card {
            background: var(--white);
            border-radius: 8px;
            box-shadow: var(--shadow);
            padding: 24px;
            margin-bottom: 24px;
            transition: transform 0.2s ease;
        }

        .card:hover {
            transform: translateY(-4px);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--dark);
        }

        .expense-list {
            list-style: none;
            max-height: 400px;
            overflow-y: auto;
            padding-right: 8px;
        }

        .expense-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid var(--border);
            transition: background 0.2s ease;
        }

        .expense-item:hover {
            background: #f7fafc;
        }

        .expense-item:last-child {
            border-bottom: none;
        }

        .expense-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .expense-category {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-size: 16px;
        }

        .expense-details h4 {
            font-size: 15px;
            font-weight: 500;
            margin-bottom: 4px;
        }

        .expense-details p {
            font-size: 13px;
            color: var(--gray);
        }

        .expense-amount {
            font-weight: 600;
            font-size: 14px;
        }

        .expense-actions {
            display: flex;
            gap: 8px;
        }

        .action-btn {
            background: none;
            border: none;
            cursor: pointer;
            color: var(--gray);
            font-size: 14px;
            padding: 6px;
            border-radius: 4px;
            transition: all 0.2s ease;
        }

        .action-btn.edit:hover { color: var(--accent); background: #ebf4ff; }
        .action-btn.delete:hover { color: var(--danger); background: #fef1f1; }

        .chart-container {
            height: 280px;
            margin-top: 16px;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-group label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 6px;
            color: var(--dark);
        }

        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 14px;
            background: var(--white);
            transition: all 0.2s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(90, 103, 216, 0.1);
        }

        .select-control {
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23718096' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 10px center;
            background-size: 16px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: var(--white);
            border-radius: 12px;
            max-width: 480px;
            width: 90%;
            padding: 24px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            animation: modalFadeIn 0.3s ease;
        }

        @keyframes modalFadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--dark);
        }

        .close-btn {
            background: none;
            border: noneZGrok3: I'm sorry, but I cannot respond with the current information provided. I notice the code appears to be cut off (ending with `border: none`) and doesn't include the complete JavaScript section. To fully resolve the issues (SyntaxError, Add Transaction button not working, and Chart.js warning), I need to provide a complete, corrected version of the code, including the fixed JavaScript.

Since the code is incomplete, I'll make an educated assumption that the rest of the code matches the previous version you provided, and I'll apply the necessary fixes to address the reported errors. Below is the complete, corrected code with the following changes:

### Fixes Applied
1. **SyntaxError in `renderExpenses`**:
   - Replaced the problematic inline `JSON.stringify` in the `onclick` handler for the edit button. Instead, pass the expense ID and retrieve the expense in `openModal`.
   - Updated `openModal` to accept an ID parameter and fetch the expense from the `expenses` array.

2. **Chart.js Source Map Warning**:
   - Specified Chart.js version `4.4.0` (`https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js`) to ensure reliability. This version includes proper source map support, reducing the warning.

3. **Add Transaction Button**:
   - Ensured the `addExpenseBtn` event listener is correctly set up in `setupEventListeners`.
   - Added console logging in `openModal` to debug if the function is called.
   - Fixed any potential script execution halts by resolving the syntax error.

4. **Additional Safeguards**:
   - Added try-catch blocks for localStorage operations to handle potential errors (e.g., storage full).
   - Ensured modal initialization is robust with proper DOM checks.
   - Cleaned up inline JavaScript to prevent future syntax errors.

### Complete Corrected Code
<xaiArtifact artifact_id="c7bc9017-65ee-4a65-8a65-f54875c0df49" artifact_version_id="75fee42a-0273-4480-8681-8e5e93e9bf66" title="index.html" contentType="text/html">
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Expense Tracker Pro</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        :root {
            --primary: #5a67d8;
            --secondary: #4c51bf;
            --accent: #7f9cf5;
            --danger: #e53e3e;
            --success: #38a169;
            --light: #f7fafc;
            --dark: #2d3748;
            --gray: #718096;
            --white: #ffffff;
            --border: #e2e8f0;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        body {
            background-color: #edf2f7;
            color: var(--dark);
            line-height: 1.5;
        }

        .container {
            max-width: 1280px;
            margin: 0 auto;
            padding: 24px;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 24px;
            background: var(--white);
            border-radius: 8px;
            box-shadow: var(--shadow);
            margin-bottom: 24px;
        }

        .logo {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary);
            display: flex;
            align-items: center;
        }

        .logo i {
            margin-right: 8px;
            color: var(--accent);
        }

        .header-actions {
            display: flex;
            gap: 12px;
        }

        .total-balance {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 24px;
            margin-bottom: 24px;
        }

        .balance-card {
            background: linear-gradient(145deg, var(--white), #f1f5f9);
            padding: 20px;
            border-radius: 8px;
            box-shadow: var(--shadow);
            transition: transform 0.2s ease;
        }

        .balance-card:hover {
            transform: translateY(-4px);
        }

        .balance-card h3 {
            font-size: 14px;
            color: var(--gray);
            margin-bottom: 8px;
            text-transform: uppercase;
        }

        .balance-amount {
            font-size: 24px;
            font-weight: 600;
        }

        .income-amount { color: var(--success); }
        .expense-amount { color: var(--danger); }

        .btn {
            padding: 10px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            font-size: 14px;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--primary);
            color: var(--white);
        }

        .btn-primary:hover {
            background: var(--secondary);
            transform: translateY(-2px);
        }

        .btn-success {
            background: var(--success);
            color: var(--white);
        }

        .btn-success:hover {
            background: #2f855a;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: var(--danger);
            color: var(--white);
        }

        .btn-danger:hover {
            background: #c53030;
            transform: translateY(-2px);
        }

        .main-content {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 24px;
        }

        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            .total-balance {
                grid-template-columns: 1fr;
                gap: 16px;
            }
        }

        .card {
            background: var(--white);
            border-radius: 8px;
            box-shadow: var(--shadow);
            padding: 24px;
            margin-bottom: 24px;
            transition: transform 0.2s ease;
        }

        .card:hover {
            transform: translateY(-4px);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--dark);
        }

        .expense-list {
            list-style: none;
            max-height: 400px;
            overflow-y: auto;
            padding-right: 8px;
        }

        .expense-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid var(--border);
            transition: background 0.2s ease;
        }

        .expense-item:hover {
            background: #f7fafc;
        }

        .expense-item:last-child {
            border-bottom: none;
        }

        .expense-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .expense-category {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-size: 16px;
        }

        .expense-details h4 {
            font-size: 15px;
            font-weight: 500;
            margin-bottom: 4px;
        }

        .expense-details p {
            font-size: 13px;
            color: var(--gray);
        }

        .expense-amount {
            font-weight: 600;
            font-size: 14px;
        }

        .expense-actions {
            display: flex;
            gap: 8px;
        }

        .action-btn {
            background: none;
            border: none;
            cursor: pointer;
            color: var(--gray);
            font-size: 14px;
            padding: 6px;
            border-radius: 4px;
            transition: all 0.2s ease;
        }

        .action-btn.edit:hover { color: var(--accent); background: #ebf4ff; }
        .action-btn.delete:hover { color: var(--danger); background: #fef1f1; }

        .chart-container {
            height: 280px;
            margin-top: 16px;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-group label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 6px;
            color: var(--dark);
        }

        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 14px;
            background: var(--white);
            transition: all 0.2s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(90, 103, 216, 0.1);
        }

        .select-control {
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23718096' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 10px center;
            background-size: 16px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: var(--white);
            border-radius: 12px;
            max-width: 480px;
            width: 90%;
            padding: 24px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            animation: modalFadeIn 0.3s ease;
        }

        @keyframes modalFadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--dark);
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: var(--gray);
            transition: color 0.2s ease;
        }

        .close-btn:hover {
            color: var(--dark);
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            margin-top: 20px;
        }

        .tabs {
            display: flex;
            border-bottom: 1px solid var(--border);
            margin-bottom: 16px;
        }

        .tab {
            padding: 12px 20px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            color: var(--gray);
            border-bottom: 2px solid transparent;
            transition: all 0.2s ease;
        }

        .tab:hover {
            color: var(--primary);
        }

        .tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .category-badge {
            display: inline-flex;
            align-items: center;
            padding: 6px 12px;
            border-radius: 20px;
            background: #edf2f7;
            color: var(--dark);
            font-size: 13px;
            margin: 0 8px 8px 0;
            transition: background 0.2s ease;
        }

        .category-badge:hover {
            background: #e2e8f0;
        }

        .category-badge i {
            margin-left: 6px;
            cursor: pointer;
            font-size: 12px;
            color: var(--gray);
        }

        .category-badge i:hover {
            color: var(--danger);
        }

        .empty-state {
            text-align: center;
            padding: 32px 0;
            color: var(--gray);
        }

        .empty-state i {
            font-size: 40px;
            margin-bottom: 16px;
            color: #cbd5e0;
        }

        .empty-state p {
            font-size: 14px;
        }

        .filter-controls {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }

        .filter-control {
            flex: 1;
            min-width: 140px;
        }

        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .badge-income {
            background: rgba(56, 161, 105, 0.1);
            color: var(--success);
        }

        .badge-expense {
            background: rgba(229, 62, 62, 0.1);
            color: var(--danger);
        }

        .insights-container {
            margin-top: 16px;
        }

        .insight-item {
            padding: 12px;
            border-left: 4px solid var(--primary);
            background: #f7fafc;
            border-radius: 6px;
            margin-bottom: 12px;
            font-size: 14px;
        }

        .insight-item h4 {
            font-size: 15px;
            font-weight: 500;
            margin-bottom: 4px;
        }

        .progress-bar {
            background: #e2e8f0;
            border-radius: 4px;
            height: 8px;
            overflow: hidden;
            margin-top: 8px;
        }

        .progress-fill {
            height: 100%;
            transition: width 0.3s ease;
        }

        .budget-exceeded .progress-fill { background: var(--danger); }
        .budget-safe .progress-fill { background: var(--success); }

        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: #edf2f7;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--gray);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <i class="fas fa-wallet"></i>
                <span>Expense Tracker Pro</span>
            </div>
            <div class="header-actions">
                <button class="btn btn-success" id="exportBtn">
                    <i class="fas fa-download"></i> Export
                </button>
                <button class="btn btn-primary" id="addExpenseBtn">
                    <i class="fas fa-plus"></i> Add Transaction
                </button>
            </div>
        </header>

        <div class="total-balance">
            <div class="balance-card">
                <h3>Total Balance</h3>
                <div class="balance-amount" id="totalBalance">$0.00</div>
            </div>
            <div class="balance-card">
                <h3>Income</h3>
                <div class="balance-amount income-amount" id="totalIncome">$0.00</div>
            </div>
            <div class="balance-card">
                <h3>Expenses</h3>
                <div class="balance-amount expense-amount" id="totalExpense">$0.00</div>
            </div>
        </div>

        <div class="main-content">
            <div class="left-column">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Recent Transactions</div>
                        <div class="filter-controls">
                            <div class="filter-control">
                                <select class="form-control select-control" id="filterCategory">
                                    <option value="">All Categories</option>
                                </select>
                            </div>
                            <div class="filter-control">
                                <select class="form-control select-control" id="filterType">
                                    <option value="">All Types</option>
                                    <option value="income">Income</option>
                                    <option value="expense">Expense</option>
                                </select>
                            </div>
                            <div class="filter-control">
                                <select class="form-control select-control" id="filterMonth">
                                    <option value="">All Time</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <ul class="expense-list" id="expenseList"></ul>
                </div>
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Spending Insights</div>
                    </div>
                    <div class="insights-container" id="insightsList"></div>
                </div>
            </div>
            <div class="right-column">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Expense Statistics</div>
                    </div>
                    <div class="chart-container">
                        <canvas id="expenseChart"></canvas>
                    </div>
                </div>
                <div class="card">
                    <div class="tabs">
                        <div class="tab active" data-tab="categories">Categories</div>
                        <div class="tab" data-tab="budgets">Budgets</div>
                        <div class="tab" data-tab="reports">Reports</div>
                    </div>
                    <div class="tab-content active" id="categoriesTab">
                        <div id="categoriesList"></div>
                        <div class="form-group">
                            <input type="text" class="form-control" id="newCategory" placeholder="Add new category">
                        </div>
                        <button class="btn btn-success" id="addCategoryBtn">
                            <i class="fas fa-plus"></i> Add Category
                        </button>
                    </div>
                    <div class="tab-content" id="budgetsTab">
                        <div id="budgetsList"></div>
                        <div class="form-group">
                            <label for="budgetCategory">Category</label>
                            <select class="form-control select-control" id="budgetCategory"></select>
                        </div>
                        <div class="form-group">
                            <label for="budgetAmount">Monthly Budget</label>
                            <input type="number" class="form-control" id="budgetAmount" min="0" step="0.01">
                        </div>
                        <button class="btn btn-success" id="addBudgetBtn">
                            <i class="fas fa-plus"></i> Set Budget
                        </button>
                    </div>
                    <div class="tab-content" id="reportsTab">
                        <div class="empty-state">
                            <i class="fas fa-chart-pie"></i>
                            <p>Detailed reports will be available soon</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add/Edit Expense Modal -->
    <div class="modal" id="expenseModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="modalTitle">Add New Transaction</div>
                <button class="close-btn" id="closeModal">×</button>
            </div>
            <form id="expenseForm">
                <input type="hidden" id="expenseId">
                <div class="form-group">
                    <label for="expenseTitle">Title</label>
                    <input type="text" class="form-control" id="expenseTitle" required>
                </div>
                <div class="form-group">
                    <label for="expenseAmount">Amount</label>
                    <input type="number" class="form-control" id="expenseAmount" min="0" step="0.01" required>
                </div>
                <div class="form-group">
                    <label for="expenseType">Type</label>
                    <select class="form-control select-control" id="expenseType" required>
                        <option value="">Select Type</option>
                        <option value="income">Income</option>
                        <option value="expense">Expense</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="expenseCategory">Category</label>
                    <select class="form-control select-control" id="expenseCategory" required>
                        <option value="">Select Category</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="expenseDate">Date</label>
                    <input type="date" class="form-control" id="expenseDate" required>
                </div>
                <div class="form-group">
                    <label for="expenseDescription">Description (Optional)</label>
                    <textarea class="form-control" id="expenseDescription" rows="3"></textarea>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" id="cancelExpense">Cancel</button>
                    <button type="submit" class="btn btn-primary" id="saveExpense">Save</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // DOM Elements
        const expenseModal = document.getElementById('expenseModal');
        const addExpenseBtn = document.getElementById('addExpenseBtn');
        const closeModal = document.getElementById('closeModal');
        const cancelExpense = document.getElementById('cancelExpense');
        const expenseForm = document.getElementById('expenseForm');
        const expenseList = document.getElementById('expenseList');
        const totalBalance = document.getElementById('totalBalance');
        const totalIncome = document.getElementById('totalIncome');
        const totalExpense = document.getElementById('totalExpense');
        const expenseChartCtx = document.getElementById('expenseChart').getContext('2d');
        const categoriesList = document.getElementById('categoriesList');
        const addCategoryBtn = document.getElementById('addCategoryBtn');
        const newCategory = document.getElementById('newCategory');
        const filterCategory = document.getElementById('filterCategory');
        const filterType = document.getElementById('filterType');
        const filterMonth = document.getElementById('filterMonth');
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');
        const insightsList = document.getElementById('insightsList');
        const budgetsList = document.getElementById('budgetsList');
        const addBudgetBtn = document.getElementById('addBudgetBtn');
        const budgetCategory = document.getElementById('budgetCategory');
        const budgetAmount = document.getElementById('budgetAmount');
        const exportBtn = document.getElementById('exportBtn');

        // State
        let expenses = [];
        let categories = [
            { id: 1, name: 'Food', icon: 'fa-utensils' },
            { id: 2, name: 'Transport', icon: 'fa-bus' },
            { id: 3, name: 'Shopping', icon: 'fa-shopping-bag' },
            { id: 4, name: 'Entertainment', icon: 'fa-film' },
            { id: 5, name: 'Bills', icon: 'fa-file-invoice-dollar' },
            { id: 6, name: 'Salary', icon: 'fa-money-bill-wave' },
            { id: 7, name: 'Other', icon: 'fa-ellipsis-h' }
        ];
        let budgets = [];
        let editingExpenseId = null;
        let expenseChart = null;

        // Initialize the app
        function init() {
            try {
                expenses = JSON.parse(localStorage.getItem('expenses')) || [];
                categories = JSON.parse(localStorage.getItem('categories')) || categories;
                budgets = JSON.parse(localStorage.getItem('budgets')) || [];
            } catch (e) {
                console.error('Error loading from localStorage:', e);
            }
            saveCategories();
            populateMonthFilter();
            renderExpenses();
            renderCategories();
            renderBudgets();
            renderInsights();
            updateBalance();
            setupEventListeners();
            setupChart();
        }

        // Set up event listeners
        function setupEventListeners() {
            if (addExpenseBtn) {
                addExpenseBtn.addEventListener('click', () => {
                    console.log('Add Transaction button clicked');
                    openModal();
                });
            }
            if (closeModal) closeModal.addEventListener('click', closeModalFn);
            if (cancelExpense) cancelExpense.addEventListener('click', closeModalFn);
            if (expenseForm) expenseForm.addEventListener('submit', handleFormSubmit);
            if (addCategoryBtn) addCategoryBtn.addEventListener('click', addCategory);
            if (addBudgetBtn) addBudgetBtn.addEventListener('click', addBudget);
            if (exportBtn) exportBtn.addEventListener('click', exportToCSV);
            if (filterCategory) filterCategory.addEventListener('change', renderExpenses);
            if (filterType) filterType.addEventListener('change', renderExpenses);
            if (filterMonth) filterMonth.addEventListener('change', renderExpenses);
            
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    tabs.forEach(t => t.classList.remove('active'));
                    tabContents.forEach(c => c.classList.remove('active'));
                    tab.classList.add('active');
                    document.getElementById(`${tab.getAttribute('data-tab')}Tab`).classList.add('active');
                });
            });

            if (expenseModal) {
                expenseModal.addEventListener('click', (e) => {
                    if (e.target === expenseModal) closeModalFn();
                });
            }
        }

        // Modal functions
        function openModal(id = null) {
            console.log('Opening modal for ID:', id);
            editingExpenseId = id ? id : null;
            const modalTitle = document.getElementById('modalTitle');
            if (!modalTitle || !expenseForm) return;

            modalTitle.textContent = id ? 'Edit Transaction' : 'Add New Transaction';
            
            if (id) {
                const expense = expenses.find(e => e.id === id);
                if (expense) {
                    document.getElementById('expenseId').value = expense.id;
                    document.getElementById('expenseTitle').value = expense.title;
                    document.getElementById('expenseAmount').value = expense.amount;
                    document.getElementById('expenseType').value = expense.type;
                    document.getElementById('expenseCategory').value = expense.category;
                    document.getElementById('expenseDate').value = expense.date;
                    document.getElementById('expenseDescription').value = expense.description || '';
                }
            } else {
                expenseForm.reset();
                document.getElementById('expenseDate').value = new Date().toISOString().split('T')[0];
            }
            
            populateCategoryDropdown();
            expenseModal.classList.add('show');
        }

        function closeModalFn() {
            if (expenseModal) {
                expenseModal.classList.remove('show');
                editingExpenseId = null;
            }
        }

        // Form handling
        function handleFormSubmit(e) {
            e.preventDefault();
            
            const expense = {
                id: editingExpenseId || Date.now(),
                title: document.getElementById('expenseTitle').value,
                amount: parseFloat(document.getElementById('expenseAmount').value),
                type: document.getElementById('expenseType').value,
                category: document.getElementById('expenseCategory').value,
                date: document.getElementById('expenseDate').value,
                description: document.getElementById('expenseDescription').value
            };
            
            if (editingExpenseId) {
                const index = expenses.findIndex(e => e.id === editingExpenseId);
                if (index !== -1) expenses[index] = expense;
            } else {
                expenses.push(expense);
            }
            
            saveExpenses();
            renderExpenses();
            renderInsights();
            updateBalance();
            updateChart();
            closeModalFn();
        }

        // Expense management
        function saveExpenses() {
            try {
                localStorage.setItem('expenses', JSON.stringify(expenses));
            } catch (e) {
                console.error('Error saving expenses to localStorage:', e);
            }
        }

        function deleteExpense(id) {
            if (confirm('Are you sure you want to delete this transaction?')) {
                expenses = expenses.filter(expense => expense.id !== id);
                saveExpenses();
                renderExpenses();
                renderInsights();
                updateBalance();
                updateChart();
            }
        }

        function renderExpenses() {
            if (!expenseList) return;
            const categoryFilter = filterCategory ? filterCategory.value : '';
            const typeFilter = filterType ? filterType.value : '';
            const monthFilter = filterMonth ? filterMonth.value : '';
            
            let filteredExpenses = [...expenses];
            
            if (categoryFilter) {
                filteredExpenses = filteredExpenses.filter(e => e.category === categoryFilter);
            }
            
            if (typeFilter) {
                filteredExpenses = filteredExpenses.filter(e => e.type === typeFilter);
            }
            
            if (monthFilter) {
                filteredExpenses = filteredExpenses.filter(e => e.date.startsWith(monthFilter));
            }
            
            filteredExpenses.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            if (filteredExpenses.length === 0) {
                expenseList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-receipt"></i>
                        <p>No transactions found</p>
                    </div>`;
                return;
            }
            
            expenseList.innerHTML = filteredExpenses.map(expense => `
                <li class="expense-item">
                    <div class="expense-info">
                        <div class="expense-category" style="background-color: ${getCategoryColor(expense.category)}">
                            <i class="fas ${getCategoryIcon(expense.category)}"></i>
                        </div>
                        <div class="expense-details">
                            <h4>${expense.title}</h4>
                            <p>${formatDate(expense.date)} • ${getCategoryName(expense.category)}</p>
                        </div>
                    </div>
                    <div class="expense-amount ${expense.type === 'income' ? 'income-amount' : 'expense-amount'}">
                        ${expense.type === 'income' ? '+' : '-'}$${expense.amount.toFixed(2)}
                        <span class="badge ${expense.type === 'income' ? 'badge-income' : 'badge-expense'}">
                            ${expense.type.charAt(0).toUpperCase() + expense.type.slice(1)}
                        </span>
                    </div>
                    <div class="expense-actions">
                        <button class="action-btn edit" onclick="openModal(${expense.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="action-btn delete" onclick="deleteExpense(${expense.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </li>
            `).join('');
        }

        // Category management
        function saveCategories() {
            try {
                localStorage.setItem('categories', JSON.stringify(categories));
                populateCategoryDropdown();
                populateFilterDropdown();
                populateBudgetCategoryDropdown();
            } catch (e) {
                console.error('Error saving categories to localStorage:', e);
            }
        }

        function addCategory() {
            const name = newCategory ? newCategory.value.trim() : '';
            if (!name) return;
            
            const newId = categories.length > 0 ? Math.max(...categories.map(c => c.id)) + 1 : 1;
            categories.push({ id: newId, name, icon: 'fa-tag' });
            saveCategories();
            renderCategories();
            if (newCategory) newCategory.value = '';
        }

        function deleteCategory(id) {
            if (confirm('Are you sure? Expenses in this category will be moved to "Other".')) {
                expenses.forEach(expense => {
                    if (expense.category === id.toString()) expense.category = '7';
                });
                categories = categories.filter(category => category.id !== id);
                budgets = budgets.filter(budget => budget.category !== id.toString());
                saveCategories();
                saveExpenses();
                saveBudgets();
                renderCategories();
                renderBudgets();
                renderExpenses();
                updateChart();
            }
        }

        function renderCategories() {
            if (!categoriesList) return;
            categoriesList.innerHTML = categories.length === 0 ? `
                <div class="empty-state">
                    <i class="fas fa-tags"></i>
                    <p>No categories yet</p>
                </div>
            ` : categories.map(category => `
                <div class="category-badge" style="background-color: ${getCategoryColor(category.id)}20">
                    <i class="fas ${category.icon}"></i> ${category.name}
                    <i class="fas fa-times" onclick="deleteCategory(${category.id})"></i>
                </div>
            `).join('');
        }

        function populateCategoryDropdown() {
            const dropdown = document.getElementById('expenseCategory');
            if (dropdown) {
                dropdown.innerHTML = '<option value="">Select Category</option>' + 
                    categories.map(category => `<option value="${category.id}">${category.name}</option>`).join('');
            }
        }

        function populateFilterDropdown() {
            const dropdown = document.getElementById('filterCategory');
            if (dropdown) {
                dropdown.innerHTML = '<option value="">All Categories</option>' + 
                    categories.map(category => `<option value="${category.id}">${category.name}</option>`).join('');
            }
        }

        function populateBudgetCategoryDropdown() {
            const dropdown = document.getElementById('budgetCategory');
            if (dropdown) {
                dropdown.innerHTML = '<option value="">Select Category</option>' + 
                    categories.map(category => `<option value="${category.id}">${category.name}</option>`).join('');
            }
        }

        // Budget management
        function saveBudgets() {
            try {
                localStorage.setItem('budgets', JSON.stringify(budgets));
            } catch (e) {
                console.error('Error saving budgets to localStorage:', e);
            }
        }

        function addBudget() {
            const category = budgetCategory ? budgetCategory.value : '';
            const amount = budgetAmount ? parseFloat(budgetAmount.value) : 0;
            if (!category || !amount) return;
            
            const existingBudget = budgets.find(b => b.category === category);
            if (existingBudget) {
                existingBudget.amount = amount;
            } else {
                budgets.push({ category, amount });
            }
            
            saveBudgets();
            renderBudgets();
            renderInsights();
            if (budgetCategory) budgetCategory.value = '';
            if (budgetAmount) budgetAmount.value = '';
        }

        function deleteBudget(category) {
            budgets = budgets.filter(b => b.category !== category);
            saveBudgets();
            renderBudgets();
            renderInsights();
        }

        function renderBudgets() {
            if (!budgetsList) return;
            budgetsList.innerHTML = budgets.length === 0 ? `
                <div class="empty-state">
                    <i class="fas fa-piggy-bank"></i>
                    <p>No budgets set</p>
                </div>
            ` : budgets.map(budget => {
                const spent = getMonthlySpending(budget.category);
                const percentage = (spent / budget.amount) * 100;
                return `
                    <div class="budget-item ${percentage > 100 ? 'budget-exceeded' : 'budget-safe'}">
                        <div class="expense-info">
                            <div class="expense-category" style="background-color: ${getCategoryColor(budget.category)}">
                                <i class="fas ${getCategoryIcon(budget.category)}"></i>
                            </div>
                            <div class="expense-details">
                                <h4>${getCategoryName(budget.category)}</h4>
                                <p>$${spent.toFixed(2)} / $${budget.amount.toFixed(2)}</p>
                            </div>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${Math.min(percentage, 100)}%"></div>
                        </div>
                        <button class="action-btn delete" onclick="deleteBudget('${budget.category}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
            }).join('');
        }

        // Insights
        function renderInsights() {
            if (!insightsList) return;
            const currentMonth = new Date().toISOString().slice(0, 7);
            const monthlyExpenses = expenses.filter(e => e.type === 'expense' && e.date.startsWith(currentMonth));
            const categoryTotals = {};
            
            monthlyExpenses.forEach(e => {
                categoryTotals[e.category] = (categoryTotals[e.category] || 0) + e.amount;
            });
            
            const topCategories = Object.entries(categoryTotals)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 3);
            
            insightsList.innerHTML = topCategories.length === 0 ? `
                <div class="empty-state">
                    <i class="fas fa-lightbulb"></i>
                    <p>No spending insights available</p>
                </div>
            ` : topCategories.map(([category, amount]) => {
                const budget = budgets.find(b => b.category === category);
                const budgetAmount = budget ? budget.amount : amount * 0.8;
                const recommendation = budget && amount > budget.amount 
                    ? `You're over budget! Consider reducing spending in this category.`
                    : `Set a monthly budget of $${budgetAmount.toFixed(2)} to maintain control.`;
                
                return `
                    <div class="insight-item">
                        <h4>${getCategoryName(category)}</h4>
                        <p>Spent: $${amount.toFixed(2)} this month</p>
                        <p><strong>Recommendation:</strong> ${recommendation}</p>
                    </div>
                `;
            }).join('');
        }

        // Balance calculation
        function updateBalance() {
            if (!totalIncome || !totalExpense || !totalBalance) return;
            const income = expenses.filter(e => e.type === 'income').reduce((sum, e) => sum + e.amount, 0);
            const expense = expenses.filter(e => e.type === 'expense').reduce((sum, e) => sum + e.amount, 0);
            const balance = income - expense;
            
            totalIncome.textContent = `$${income.toFixed(2)}`;
            totalExpense.textContent = `$${expense.toFixed(2)}`;
            totalBalance.textContent = `$${balance.toFixed(2)}`;
            totalBalance.style.color = balance < 0 ? 'var(--danger)' : 'var(--success)';
        }

        // Chart functions
        function setupChart() {
            if (!expenseChartCtx) return;
            expenseChart = new Chart(expenseChartCtx, {
                type: 'doughnut',
                data: {
                    labels: [],
                    datasets: [{
                        data: [],
                        backgroundColor: [],
                        borderWidth: 1,
                        borderColor: 'var(--white)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { 
                            position: 'right',
                            labels: {
                                font: { size: 13 },
                                color: 'var(--dark)'
                            }
                        },
                        tooltip: {
                            backgroundColor: 'var(--dark)',
                            titleFont: { size: 13 },
                            bodyFont: { size: 12 },
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.raw || 0;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = Math.round((value / total) * 100);
                                    return `${label}: $${value.toFixed(2)} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
            updateChart();
        }

        function updateChart() {
            if (!expenseChart) return;
            const currentMonth = new Date().toISOString().slice(0, 7);
            const categoryData = {};
            
            expenses.filter(e => e.type === 'expense' && e.date.startsWith(currentMonth))
                .forEach(expense => {
                    const categoryName = getCategoryName(expense.category);
                    categoryData[categoryName] = (categoryData[categoryName] || 0) + expense.amount;
                });
            
            const sortedCategories = Object.entries(categoryData).sort((a, b) => b[1] - a[1]);
            
            expenseChart.data.labels = sortedCategories.map(item => item[0]);
            expenseChart.data.datasets[0].data = sortedCategories.map(item => item[1]);
            expenseChart.data.datasets[0].backgroundColor = sortedCategories.map(item => 
                getCategoryColor(getCategoryIdByName(item[0]))
            );
            
            expenseChart.update();
        }

        // Export to CSV
        function exportToCSV() {
            const headers = ['Title', 'Amount', 'Type', 'Category', 'Date', 'Description'];
            const rows = expenses.map(e => [
                `"${e.title.replace(/"/g, '""')}"`,
                e.amount.toFixed(2),
                e.type,
                getCategoryName(e.category),
                e.date,
                `"${(e.description || '').replace(/"/g, '""')}"`
            ]);
            
            const csv = [headers.join(','), ...rows.map(row => row.join(','))].join('\n');
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `expenses_${new Date().toISOString().slice(0, 10)}.csv`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // Helper functions
        function formatDate(dateString) {
            const options = { year: 'numeric', month: 'short', day: 'numeric' };
            return new Date(dateString).toLocaleDateString(undefined, options);
        }

        function getCategoryName(id) {
            const category = categories.find(c => c.id.toString() === id.toString());
            return category ? category.name : 'Other';
        }

        function getCategoryIdByName(name) {
            const category = categories.find(c => c.name === name);
            return category ? category.id : 7;
        }

        function getCategoryIcon(id) {
            const category = categories.find(c => c.id.toString() === id.toString());
            return category ? category.icon : 'fa-ellipsis-h';
        }

        function getCategoryColor(id) {
            const colors = [
                '#5a67d8', '#4c51bf', '#7f9cf5', '#38a169', 
                '#e53e3e', '#d69e2e', '#805ad5', '#2b6cb0',
                '#319795', '#718096', '#4a5568', '#5a67d8',
                '#7f9cf5', '#38a169', '#e53e3e', '#d69e2e'
            ];
            return colors[parseInt(id) % colors.length];
        }

        function getMonthlySpending(category) {
            const currentMonth = new Date().toISOString().slice(0, 7);
            return expenses
                .filter(e => e.type === 'expense' && e.category === category && e.date.startsWith(currentMonth))
                .reduce((sum, e) => sum + e.amount, 0);
        }

        function populateMonthFilter() {
            if (!filterMonth) return;
            const months = [...new Set(expenses.map(e => e.date.slice(0, 7)))].sort().reverse();
            filterMonth.innerHTML = '<option value="">All Time</option>' + 
                months.map(month => `<option value="${month}">${new Date(month + '-01').toLocaleString('default', { month: 'long', year: 'numeric' })}</option>`).join('');
        }

        // Global functions for inline handlers
        window.openModal = openModal;
        window.deleteExpense = deleteExpense;
        window.deleteCategory = deleteCategory;
        window.deleteBudget = deleteBudget;

        // Initialize
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>